// room script file

bool zebranaChochla = false;
bool woodCollected = false;
bool placedWood = false;
bool placedPot = false;
bool setFire = false;
bool wloszczyzna = false;
bool ogorki = false;
bool koperek = false;
bool lisc = false;
bool kostka = false;
bool ziemniaki = false;
bool jogurtCollected = false;
bool discoBall = false;
bool fillCup = false;
bool first_open_doors = true;
bool pick_up_play = false;

function final_scene(){
  cFabien.LoseInventory(iFilizanka);
  cGod.Say("Czy wy*cie powariowali??? Chcecie mnie otru#? Id@cie z tym do diab%a!");
  oBlysk.SetView(10,  0,  0);
  oBlysk.Visible = true;
  oBlysk.Animate(0,  4,  0, eNoBlock,  eBackwards);
  walkingChannel = aGod_sound.Play();
  walkingSound = false;
  while(oBlysk.Animating)Wait(1);
  oBlysk.Visible = false;
  cGod.x = -1000;
  Wait(40);
  dEndScena2.Start();
}

function all_items(){
  if(collectedItems == 5){
    stage = 2;
    cDruid.Walk(1770, 620, eNoBlock, eWalkableAreas);
    cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
    cFabien.FaceCharacter(cDruid);
    while(cDruid.Moving)Wait(1);
    cDruid.Say("Czas przygotowa# zupe.");
    FadeOut(2);
    oDrewno.Visible = true;  
    oGarnek2.Visible = true;
    cFabien.LoseInventory(iDrewno);
    cFabien.LoseInventory(iGarnek);
    cFabien.LoseInventory(iZapalki);
    cFabien.AddInventory(iWloszczyzna);
    cFabien.AddInventory(iOgorek);
    cFabien.AddInventory(iKoper);
    cFabien.AddInventory(iLisc);
    cFabien.AddInventory(iKostka);
    cFabien.AddInventory(iZiemniaki);
    Wait(4);
    FadeIn(2);
    cDruid.Say("Sk%adniki trzeba wrzuci# dok%adnie w takiej kolejno*ci jak na li*cie.", eBlock);
  }
}
function load_stage(){
    cFabien.UnlockView();
    cFabien.Walk(1320, 570,  eNoBlock,  eWalkableAreas);
    cDruid.Walk(1100, 570, eBlock, eWalkableAreas);
    while(cFabien.Moving)Wait(1);
    cDruid.FaceObject(oBlysk);
    cFabien.FaceObject(oBlysk);
    cFabien.LockView(FABIEN_DANCE);
    cFabien.Animate(0,  5,  1, eNoBlock, eForwards);
    cDruid.LockView(DRUID_DANCE);
    cDruid.Animate(0,  5,  1, eNoBlock, eForwards);
    discoBall = true;
    backgroundChannel.Stop();
    backgroundChannel = aWho_Likes_to_Party.Play();
    oKula.Visible = true;
    while(oKula.Y < 225){
      oKula.Y += 5;
      Wait(5);
    }
    cDruid.SpeechView = 8;
    cDruid.Say("Jar Kretson, Jar Kretson, b'stwo samozwa&cze");
    cDruid.Say("Przyb\"d@ do nas szybko, mamy +arcie, ta&ce.");
    cDruid.Say("Ofiar$ sk%adamy z tych wszystkich sk%adnik'w,");
    cDruid.Say("Co ich zdobycie da%o problem'w bez liku.");
    cDruid.SpeechView = 2;
    cDruid.LockView(DRUID_DANCE);
    cDruid.Animate(0,  5,  1, eNoBlock, eForwards);
    Wait(200);
    oBlysk.SetView(10,  0,  0);
    oBlysk.Visible = true;
    oBlysk.Animate(0,  4,  0, eNoBlock,  eBackwards);
    walkingChannel = aGod_sound.Play();
    walkingSound = false;
    while(oBlysk.Animating)Wait(1);
    oBlysk.Visible = false;
    cGod.ChangeRoom(2,  1541, 350,  eDirectionDown);
    cGod.Animate(0, 5, eRepeat, eNoBlock, eForwards);
    cFabien.UnlockView();
    cDruid.UnlockView();
    cFabien.FaceObject(oBlysk);
    cDruid.FaceObject(oBlysk);
    backgroundChannel.Stop();
    backgroundChannel = aScene_2_1___Viking_theme.Play();
    cGod.Say("Czego?", eBlock);
    cGod.Animate(0, 5, eRepeat, eNoBlock, eForwards);
}

function room_Load(){
  RemoveWalkableArea(3);
}

function room_AfterFadeIn(){
  test = aWalking_on_wooden_floor.Play();
  mouse.Mode = eModeWalkto;
  RemoveWalkableArea(3);
  backgroundChannel.Stop();
  backgroundChannel = aScene_2_1___Viking_theme.Play();
  walkingSound = false;
  walkingChannel = aWalking_on_wooden_floor.Play();
  if(walkingChannel.IsPlaying){
    walkingChannel.Stop();
    walkingSound = false;
  }
  cDruid.Walk(1000,  620, eBlock, eWalkableAreas);
  dRozmowa1.Start();
  //load_stage();
  //cDruid.FollowCharacter(cFabien, 0, 50);//,  50,  1);
}


function oDoorClosed_AnyClick()
{
  if(cFabien.ActiveInventory != null){
    if(cFabien.ActiveInventory == iSiekiera){
      cFabien.Say("P%askie drzewo, co+ to za dziwy! Szybko je por\"bie, p'kim jeszcze +ywy!");
      cFabien.Walk(3020, 620,  eBlock,  eWalkableAreas);
      walkingChannel = aChopping_wood.Play();
      walkingSound = false;
      while(walkingChannel.IsPlaying)Wait(1);
      cFabien.AddInventory(iDrewno);
      oDoorClosed.Visible = false;
      RestoreWalkableArea(3);
      mouse.Mode = eModeWalkto;
      cFabien.ActiveInventory = null;
      woodCollected = true;
      collectedItems++;
      cFabien.LoseInventory(iSiekiera);
      all_items();
    }
  }
  else{
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3020, 620,  eBlock,  eWalkableAreas);
    if(first_open_doors){
      cFabien.Say("A dok\"d te tajemne wrota wiod\"? Czy czychaj\" tam wied@my jak za wielk\" wod\"? ", eBlock);
      first_open_doors = false;
    }
    aDoor_open.Play();
    walkingSound = false;
    RestoreWalkableArea(3);
    oOpenDoors.Visible = true;
    oDoorClosed.Visible = false;
  }
}

function oOpenDoors_AnyClick()
{
   if(cFabien.ActiveInventory != null){
    if(cFabien.ActiveInventory == iSiekiera){
      cFabien.Say("P%askie drzewo, co+ to za dziwy! Szybko je por\"bie, p'kim jeszcze +ywy!");
      cFabien.Walk(3020, 620,  eBlock,  eWalkableAreas);
      walkingChannel = aChopping_wood.Play();
      walkingSound = false;
      while(walkingChannel.IsPlaying)Wait(1);
      cFabien.AddInventory(iDrewno);
      collectedItems++;
      oOpenDoors.Visible = false;
      mouse.Mode = eModeWalkto;
      cFabien.ActiveInventory = null;
      woodCollected = true;
      cFabien.LoseInventory(iSiekiera);
      all_items();
    }
   else{
     cFabien.ActiveInventory = null;
     mouse.Mode = eModeInteract;
   }
  }
  else{
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3020, 620,  eNoBlock,  eWalkableAreas);
    while(cFabien.Moving)Wait(1);
    walkingChannel = aDoor_close.Play();
    walkingSound = false;
    RemoveWalkableArea(3);
    oOpenDoors.Visible = false;
    oDoorClosed.Visible = true;
  }
}

function oSkrzyniaZ_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2940, 620,  eBlock,  eWalkableAreas);
  oSkrzyniaZ.Visible = false;
  oSkrzyniaO.Visible = true;
  if(filizankaCollected == false){
    filizankaCollected = true;
    cFabien.Say("Fili+anka tu jest stara, przyda si$ by nie pi# z gara.", eBlock);
    cFabien.AddInventory(iFilizanka);
    walkingChannel.Stop();
    walkingChannel = aPick_up_item.Play();
    //collectedItems++;
  }
}

function OGarnek_AnyClick()
{
  if(oOpenDoors.Visible == true || woodCollected == true){
    mouse.Mode = eModeWalkto;
    cFabien.Walk(3300, 620,  eBlock,  eWalkableAreas);
    cFabien.Say("Du+y nocnik, *wietna sprawa, wy*mienita b$dzie w nim dla b'stwa strawa!", eBlock);
    oSchody.Visible = false;
    OGarnek.Visible = false;
    cFabien.AddInventory(iGarnek);
    test.Stop();
    test = aPick_up_item.Play();
    collectedItems++;
    all_items();
  }
}

function oSiekiera_AnyClick()
{
  mouse.Mode = eModeWalkto;
  if(cDruid.x > 1150){
    cDruid.Walk(1150, 620, eNoBlock, eWalkableAreas);
  }
  cFabien.Walk(680, 620,  eBlock,  eWalkableAreas);
  walkingChannel.Stop();
  walkingSound = false;
  cDruid.FaceCharacter(cFabien);
  oSiekiera.Visible = false;
  cFabien.AddInventory(iSiekiera);
  walkingChannel.Stop();
  walkingChannel = aPick_up_item.Play();
  while(cDruid.Moving)Wait(1);
  cDruid.Say("O, znalaz%e* siekier$! Tylko si$ nie potnij!", eBlock);
  cDruid.Say("Gdzie* na pewno znajdzie si$ jakie* drzewo na opa%.", eBlock);
  cDruid.Walk(2651,  620, eNoBlock, eWalkableAreas);
  collectedItems++;
}

function oFiranki_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2550, 620,  eBlock,  eWalkableAreas);
  cFabien.Say("Oh firanki, tego trzeba! Dobry fartuch spad% mi z nieba! ", eBlock);
  oFiranki.Visible = false;
  walkingChannel.Stop();
  walkingChannel = aPick_up_item.Play();
  collectedItems++;
  cFabien.LockView(3);
  all_items();
}

function oDuzaSkrzyniaZ_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2400,  620,  eBlock,  eWalkableAreas);
  oDuzaSkrzyniaO.Visible = true;
  oDuzaSkrzyniaZ.Visible = false;
  if (zebranaChochla == false){
    zebranaChochla = true;
    if(stage != 2)cFabien.Say("O, *wietnie! Przyda mi si$ ta %ycha, lepiej nie miesza# palcem bo w tej zupie wszystko zdycha.", eBlock);
    cFabien.AddInventory(iChochla);
    walkingChannel.Stop();
    walkingChannel = aPick_up_item.Play();
    walkingSound = false;
  }
}

function oDuzaSkrzyniaO_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2400,  620,  eBlock,  eWalkableAreas);
  oDuzaSkrzyniaO.Visible = false;
  oDuzaSkrzyniaZ.Visible = true;
}

function oSkrzyniaO_AnyClick()
{
  mouse.Mode = eModeWalkto;
  cFabien.Walk(2940, 620,  eBlock,  eWalkableAreas);
  oSkrzyniaZ.Visible = true;
  oSkrzyniaO.Visible = false;
}

function on_call(int value)
{
  if (value == 1){
    oDrewno.Visible = true;  
    oGarnek2.Visible = true;
    cFabien.LoseInventory(iDrewno);
    cFabien.LoseInventory(iGarnek);
    cFabien.LoseInventory(iZapalki);
    cFabien.AddInventory(iWloszczyzna);
    cFabien.AddInventory(iOgorek);
    cFabien.AddInventory(iKoper);
    cFabien.AddInventory(iLisc);
    cFabien.AddInventory(iKostka);
    cFabien.AddInventory(iZiemniaki);
    Wait(4);
    FadeIn(2);
  }
  if (value == 2 && fillCup == true){
    final_scene();
  }
  if(value == 4){
    all_items();
  }
}


function oGarnek2_UseInv()
{
  if (stage == 2){
    if(cFabien.ActiveInventory != null){
      if(wloszczyzna == false){
        if(cFabien.ActiveInventory == iWloszczyzna){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          wloszczyzna = true;
          cFabien.LoseInventory(iWloszczyzna);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
        }
        else {
          
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
      else if (ogorki == false){
        if(cFabien.ActiveInventory == iOgorek){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          ogorki = true;
          cFabien.LoseInventory(iOgorek);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
        }
        else {
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
      else if (koperek == false){
        if(cFabien.ActiveInventory == iKoper){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          koperek = true;
          cFabien.LoseInventory(iKoper);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
        }
        else {
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
      else if (lisc == false){
        if(cFabien.ActiveInventory == iLisc){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          lisc = true;
          cFabien.LoseInventory(iLisc);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
        }
        else {
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
      else if (kostka == false){
        if(cFabien.ActiveInventory == iKostka){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          kostka = true;
          cFabien.LoseInventory(iKostka);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
        }
        else {
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
      else if (ziemniaki == false){
        if(cFabien.ActiveInventory == iZiemniaki){
          cFabien.Walk(1291, 620, eBlock, eWalkableAreas);
          cFabien.FaceCharacter(cDruid);
          mouse.Mode = eModeWalkto;
          cFabien.ActiveInventory = null;
          ziemniaki = true;
          cFabien.LoseInventory(iZiemniaki);
          walkingChannel = aDrop_item_into_the_soup.Play();
          walkingSound = false;
          cDruid.Say("Babka Agafia mnie zawsze uczy%a, by jogurtem zupka zabielona by%a.");
          load_stage();
          stage = 3;
        }
        else {
          cFabien.ActiveInventory = null;
          cDruid.Say("W KOLEJNOŒCI Z LISTY!");
          mouse.Mode = eModeWalkto;
        }
      }
    }
  }
  if(cFabien.ActiveInventory == iFilizanka){
    fillCup = true;
    Mouse.Mode = eModeWalkto;
    cFabien.ActiveInventory = null;
    Display("filizanka");
  }
}

function repeatedly_execute_always()
{
  if(cFabien.Moving && !walkingChannel.IsPlaying){
    walkingChannel = aWalking_on_wooden_floor.Play(eRepeat);
    walkingSound = true;
  }
  else if(!cFabien.Moving && walkingSound == true){
    walkingSound = false;
    if(walkingChannel.IsPlaying){
      walkingChannel.Stop();
    }
  }
  if (stage == 3){
    
  }
}

function hHotspot1_AnyClick()
{
  cFabien.FaceLocation(1547, 483, eNoBlock);
  cFabien.Say("Puste palenisko, czas zebra# rzeczy na ognisko.", eBlock);
}
